#!/usr/bin/env bun

// Daily parity check script for local development
import { $ } from "bun"

console.log("üîÑ Daily Kuucode Parity Check")
console.log("=" .repeat(40))

try {
  // Check for new commits in the last 24 hours
  console.log("üì° Fetching upstream changes...")
  await $`git fetch upstream`
  
  // Run parity check
  console.log("üîç Checking for new commits...")
  await $`bun scripts/parity check "24 hours ago" --auto-triage`
  
  // Show dashboard
  console.log("\nüìä Current Status:")
  await $`bun scripts/parity dashboard`
  
  // Show high priority items
  console.log("\nüö® High Priority Items:")
  const result = await $`bun scripts/parity list pending high`.quiet()
  const lines = result.stdout.toString().trim().split('\n')
  
  if (lines.length > 1) {
    console.log(result.stdout.toString())
    
    // Run integration analysis on high priority items
    console.log("\nü§ñ Running integration analysis...")
    await $`bun scripts/parity-integrate batch`
    
    console.log("\nüí° Next steps:")
    console.log("  1. Review high priority items: bun scripts/parity review <hash>")
    console.log("  2. Auto-integrate safe items: bun scripts/parity-integrate auto <hash>")
    console.log("  3. Create draft PRs: bun scripts/parity-integrate draft-pr <hash>")
    console.log("  4. Update status: bun scripts/parity update <hash> <status>")
    console.log("  5. Check full dashboard: bun scripts/parity dashboard")
    
    // Send Discord notification for high priority items
    const highPriorityCount = lines.length - 1
    await $`bun scripts/parity-notify critical "Found ${highPriorityCount} high priority commits requiring review"`
  } else {
    console.log("‚úÖ No high priority items pending!")
    
    // Send daily status notification
    await $`bun scripts/parity-notify daily "Daily parity check complete - no high priority items pending"`
  }
  
} catch (error) {
  console.error("‚ùå Error during parity check:", error)
  process.exit(1)
}